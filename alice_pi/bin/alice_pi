#!/env/bin/python

from w1thermsensor import W1ThermSensor
import os
import time
import utils
import argparse

abspath = os.path.abspath(__file__)
dname = os.path.dirname(abspath)

def main(sleep_time):
    failures = 0

    attributes = {'friendly_name': 'Server Temperature',
                  'unit_of_measurement':  u'\xb0F',
                  'icon': 'mdi:thermometer'}
    while True:
        try:
            temperature = get_temperature()
            utils.send_to_ha('sensor.server_room_temperature',
                             temperature,
                             attributes)
        except Exception as e:

            print(e)
            failures += 1

            if failures > 10:
                pass
                utils.restart()

            time.sleep(60)

            continue

        failures = 0
        time.sleep(sleep_time)

if __name__ == "__main__":
    main(60)
